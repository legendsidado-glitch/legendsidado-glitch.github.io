<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&lt;\&gt; Scriptsell</title>
    <link rel="icon" href="Scriptsell.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* All CSS is consolidated here for proper structure */

        /* Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #111;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
        }

        .loading-circles {
            position: relative;
            width: 150px;
            height: 150px;
        }

        .circle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ff3cac, #784ba0);
            border-radius: 50%;
            animation: moveCircle 2s linear infinite;
        }

        @keyframes moveCircle {
            0% {
                transform: translate(0, 0);
            }
            25% {
                transform: translate(50px, 30px);
            }
            50% {
                transform: translate(-50px, 50px);
            }
            75% {
                transform: translate(30px, -40px);
            }
            100% {
                transform: translate(0, 0);
            }
        }

        /* Loading Text */
        #loading-text {
            color: #fff;
            font-size: 1.5rem;
            margin-top: 30px;
            text-align: center;
        }

        /* Loading Bar */
        #loading-bar-container {
            width: 300px;
            height: 20px;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        #loading-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #ff3cac, #784ba0);
            transition: width 0.2s ease;
        }

        #loading-percent {
            color: #fff;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* Website Background Animation */
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: #111;
        }

        /* Header */
        header {
            width: 100%;
            padding: 20px;
            text-align: center;
            color: #fff;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        header h2 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #aaa;
        }

        #release-timer {
            font-size: 1rem;
            margin-bottom: 20px;
            color: #ff3cac;
        }

        /* Navigation Buttons */
        nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        nav a {
            padding: 10px 20px;
            color: #fff;
            background: #222;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: 0.3s;
        }

        nav a:hover {
            background: linear-gradient(90deg, #ff3cac, #784ba0);
            transform: scale(1.05);
        }

        /* Top Action Buttons */
        #top-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-btn {
            position: relative;
            padding: 10px 18px;
            background: #222;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .action-btn:hover {
            background: linear-gradient(90deg, #ff3cac, #784ba0);
            transform: scale(1.05);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* Cart Bubble */
        .cart-bubble {
            position: absolute;
            top: -8px;
            right: -8px;
            background: red;
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Custom Frames */
        .custom-frame {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 60, 172, 0.5);
            transition: transform 0.3s;
            z-index: 100;
            width: 400px;
            max-width: 90%;
            display: none; /* Add this to hide frames by default */
        }

        .custom-frame.show {
            transform: translate(-50%, -50%) scale(1);
            display: block;
        }

        .frame-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .frame-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .close-btn {
            cursor: pointer;
            background: red;
            border: none;
            color: #fff;
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: bold;
        }

        .frame-content {
            margin-bottom: 15px;
        }

        .frame-content input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border-radius: 8px;
            border: none;
        }

        .submit-btn {
            cursor: pointer;
            background: green;
            border: none;
            color: #fff;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            transition: 0.2s;
        }

        .submit-btn:hover {
            background: linear-gradient(90deg, #28ff7b, #0fd3ff);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .cart-buttons button {
            width: 48%;
        }

        .admin-section {
            border-top: 1px solid #333;
            padding-top: 15px;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loading-circles">
            <div class="circle" style="top:0; left:50%; animation-delay:0s;"></div>
            <div class="circle" style="top:50%; left:100%; animation-delay:0.2s;"></div>
            <div class="circle" style="top:100%; left:50%; animation-delay:0.4s;"></div>
            <div class="circle" style="top:50%; left:0%; animation-delay:0.6s;"></div>
            <div class="circle" style="top:25%; left:75%; animation-delay:0.8s;"></div>
            <div class="circle" style="top:75%; left:25%; animation-delay:1s;"></div>
        </div>
        <div id="loading-text">Loading Scripts</div>
        <div id="loading-bar-container">
            <div id="loading-bar"></div>
        </div>
        <div id="loading-percent">0%</div>
    </div>

    <canvas id="background-canvas"></canvas>

    <header>
        <h1>&lt;\&gt; Scriptsell</h1>
        <h2>Buy Top Roblox Products</h2>
        <div id="release-timer"></div>
        <nav>
            <a href="index.html">Home</a>
            <a href="hot-deals.html">Best Deals</a>
            <a href="products.html">Best Products</a>
            <a href="infos.html">Info</a>
            <a href="all-products.html">All Products</a>
        </nav>
    </header>

    <div id="top-buttons">
        <div class="action-btn" id="admin-btn">Admin</div>
        <div class="action-btn" id="cart-btn">Cart <div class="cart-bubble" id="cart-count">0</div></div>
        <div class="action-btn" id="search-btn">Search</div>
        <div class="action-btn" id="login-btn">Login</div>
        <div class="action-btn" id="signin-btn">Sign In</div>
        <div class="action-btn" id="recommend-btn">Recommendations</div>
        <div class="action-btn" id="settings-btn">Settings</div>
        <div class="action-btn" id="cookies-btn">Cookies</div>
    </div>

    <div class="custom-frame" id="cart-frame">
        <div class="frame-header">
            <h3>Cart</h3>
            <button class="close-btn" onclick="closeFrame('cart-frame')">X</button>
        </div>
        <div class="frame-content" id="cart-items"></div>
        <div class="frame-actions">
            <button class="submit-btn" onclick="clearCart()">Clear All</button>
            <button class="submit-btn" onclick="openCheckout()">Checkout</button>
        </div>
    </div>

    <div class="custom-frame" id="checkout-frame">
        <div class="frame-header">
            <h3>Checkout</h3>
            <button class="close-btn" onclick="closeFrame('checkout-frame')">X</button>
        </div>
        <div class="frame-content">
            <div id="checkout-items"></div>
            <h4>Total: $<span id="checkout-total">0</span></h4>
            <button class="submit-btn" onclick="buyCart()">Buy</button>
        </div>
    </div>

    <div class="custom-frame" id="admin-frame">
        <div class="frame-header">
            <h3>Admin Panel</h3>
            <button class="close-btn" onclick="closeFrame('admin-frame')">X</button>
        </div>
        <div class="frame-content">
            <input type="text" id="admin-username" placeholder="Username">
            <input type="password" id="admin-password" placeholder="Password">
            <button class="submit-btn" onclick="submitAdminLogin()">Submit</button>
        </div>
    </div>

    <div class="custom-frame" id="login-frame">
        <div class="frame-header">
            <h3>Login</h3>
            <button class="close-btn" onclick="closeFrame('login-frame')">X</button>
        </div>
        <div class="frame-content">
            <input type="text" id="login-username" placeholder="Username">
            <input type="password" id="login-password" placeholder="Password">
            <input type="text" id="login-rank" placeholder="Rank">
            <button class="submit-btn" onclick="submitLogin()">Login</button>
        </div>
    </div>

    <div class="custom-frame" id="signin-frame">
        <div class="frame-header">
            <h3>Sign In</h3>
            <button class="close-btn" onclick="closeFrame('signin-frame')">X</button>
        </div>
        <div class="frame-content">
            <input type="text" id="signin-username" placeholder="Username">
            <input type="password" id="signin-password" placeholder="Password">
            <input type="password" id="signin-password2" placeholder="Confirm Password">
            <button class="submit-btn" onclick="submitSignin()">Create Account</button>
            <button class="submit-btn" id="see-btn" onclick="toggleSee()">See/Unsee</button>
        </div>
    </div>

    <div class="custom-frame" id="recommend-frame">
        <div class="frame-header">
            <h3>Recommendations</h3>
            <button class="close-btn" onclick="closeFrame('recommend-frame')">X</button>
        </div>
        <div class="frame-content" id="recommend-list"></div>
        <input type="text" id="recommend-input" placeholder="Write your recommendation...">
        <button class="submit-btn" onclick="submitRecommendation()">Submit</button>
    </div>

    <div class="custom-frame" id="settings-frame">
        <div class="frame-header">
            <h3>Settings</h3>
            <button class="close-btn" onclick="closeFrame('settings-frame')">X</button>
        </div>
        <div class="frame-content">
            <label for="bg-color">Background Color:</label>
            <input type="color" id="bg-color" onchange="changeBackgroundColor()">
            <label for="music-volume">Music Volume:</label>
            <input type="range" id="music-volume" min="0" max="1" step="0.01" onchange="changeVolume()">
            <button class="submit-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="custom-frame" id="cookies-frame">
        <div class="frame-header">
            <h3>Cookies Settings</h3>
            <button class="close-btn" onclick="closeFrame('cookies-frame')">X</button>
        </div>
        <div class="frame-content">
            <p>Manage your cookies preferences here:</p>
            <button class="submit-btn" onclick="acceptCookies()">Accept All Cookies</button>
            <button class="submit-btn" onclick="declineCookies()">Decline Cookies</button>
        </div>
    </div>

    <div class="custom-frame" id="admin-panel-frame">
        <div class="frame-header">
            <h3>Admin Panel</h3>
            <button class="close-btn" onclick="closeFrame('admin-panel-frame')">X</button>
        </div>
        <div class="frame-content">
            <div class="admin-section">
                <h4>Add Product</h4>
                <input type="text" id="add-name" placeholder="Product Name">
                <input type="number" id="add-price" placeholder="Price">
                <input type="datetime-local" id="add-timer" placeholder="Release Timer (Optional)">
                <input type="text" id="add-why" placeholder="Why Buy (Optional)">
                <input type="text" id="add-rank" placeholder="Rank (Optional)">
                <button class="submit-btn" onclick="addProduct()">Add Product</button>
            </div>
            <div class="admin-section">
                <h4>Edit Product</h4>
                <input type="text" id="edit-id" placeholder="Product ID">
                <input type="text" id="edit-name" placeholder="New Name (Optional)">
                <input type="number" id="edit-price" placeholder="New Price (Optional)">
                <input type="datetime-local" id="edit-timer" placeholder="New Timer (Optional)">
                <input type="text" id="edit-why" placeholder="New Why Buy (Optional)">
                <button class="submit-btn" onclick="editProduct()">Edit Product</button>
            </div>
            <div class="admin-section">
                <h4>Delete Product</h4>
                <input type="text" id="delete-id" placeholder="Product ID">
                <button class="submit-btn" onclick="deleteProduct()">Delete Product</button>
            </div>
            <div class="admin-section">
                <h4>Shutdown Website</h4>
                <button class="submit-btn" onclick="shutdownWebsite()">Shutdown</button>
            </div>
        </div>
    </div>

    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Loading screen logic (Corrected to run first)
        const loadingText = document.getElementById('loading-text');
        const loadingBar = document.getElementById('loading-bar');
        const loadingPercent = document.getElementById('loading-percent');

        const texts = [
            "Loading Scripts",
            "Loading Products",
            "Loading Cookies",
            "Loading Updates",
            "Loading Cart"
        ];

        let percent = 0;
        let textIndex = 0;

        const loadingInterval = setInterval(() => {
            percent++;
            loadingBar.style.width = percent + "%";
            loadingPercent.textContent = percent + "%";

            if (percent % 20 === 0 && textIndex < texts.length) {
                loadingText.textContent = texts[textIndex];
                textIndex++;
            }

            if (percent >= 100) {
                clearInterval(loadingInterval);
                document.getElementById('loading-screen').style.display = 'none';
                initWebsite();
            }
        }, 50);

        // All other JS is moved to this function to run after the loading screen
        function initWebsite() {
            // General functions for frames
            function openFrame(id) {
                document.getElementById(id).classList.add('show');
            }

            function closeFrame(id) {
                document.getElementById(id).classList.remove('show');
            }

            // Release Timer
            function updateReleaseTimer() {
                const releaseDate = new Date('2026-01-01T00:00:00');
                const now = new Date();
                const diff = releaseDate - now;
                if (diff <= 0) {
                    document.getElementById('release-timer').textContent = "Released!";
                    return;
                }
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                const seconds = Math.floor((diff / 1000) % 60);
                document.getElementById('release-timer').textContent = `${days}d ${hours}h ${minutes}m ${seconds}s remaining`;
            }
            setInterval(updateReleaseTimer, 1000);
            updateReleaseTimer();

            // Background Animation
            const canvas = document.getElementById('background-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const balls = [];
            const ballCount = 30;

            for (let i = 0; i < ballCount; i++) {
                balls.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: 3 + Math.random() * 3,
                    dx: (Math.random() - 0.5) * 1.5,
                    dy: (Math.random() - 0.5) * 1.5
                });
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < balls.length; i++) {
                    for (let j = i + 1; j < balls.length; j++) {
                        if (Math.random() > 0.5) continue;
                        ctx.beginPath();
                        ctx.moveTo(balls[i].x, balls[i].y);
                        ctx.lineTo(balls[j].x, balls[j].y);
                        ctx.strokeStyle = 'rgba(120,75,160,0.2)';
                        ctx.stroke();
                    }
                }
                balls.forEach(ball => {
                    ctx.beginPath();
                    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255,60,172,0.7)';
                    ctx.fill();
                    ball.x += ball.dx;
                    ball.y += ball.dy;
                    if (ball.x < 0 || ball.x > canvas.width) ball.dx *= -1;
                    if (ball.y < 0 || ball.y > canvas.height) ball.dy *= -1;
                });
                requestAnimationFrame(draw);
            }
            draw();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });

            // Cart and Checkout Logic
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartCountEl = document.getElementById('cart-count');

            function saveCart() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }

            function updateCartBubble() {
                cartCountEl.textContent = cart.length;
            }

            function updateCartUI() {
                const container = document.getElementById('cart-items');
                container.innerHTML = '';
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (!product) return;
                    const div = document.createElement('div');
                    div.className = 'cart-item';
                    div.innerHTML = `
                        <span>${product.name} ($${product.price})</span>
                        <input type="number" value="${item.qty}" min="1" onchange="updateQty('${item.id}', this.value)">
                        <button onclick="removeFromCart('${item.id}')">Remove</button>
                    `;
                    container.appendChild(div);
                });
                updateCartBubble();
            }

            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                const existing = cart.find(c => c.id === productId);
                if (existing) {
                    existing.qty++;
                } else {
                    cart.push({
                        id: productId,
                        qty: 1
                    });
                }
                saveCart();
                updateCartUI();
                alert(`${product.name} added to cart!`);
            }

            function removeFromCart(productId) {
                cart = cart.filter(c => c.id !== productId);
                saveCart();
                updateCartUI();
            }

            function updateQty(productId, qty) {
                const item = cart.find(c => c.id === productId);
                if (item) {
                    item.qty = parseInt(qty, 10) < 1 ? 1 : parseInt(qty, 10);
                    saveCart();
                    updateCartUI();
                }
            }

            function clearCart() {
                if (confirm('Clear all items from cart?')) {
                    cart = [];
                    saveCart();
                    updateCartUI();
                }
            }

            function openCheckout() {
                const checkoutFrame = document.getElementById('checkout-frame');
                updateCheckout();
                openFrame('checkout-frame');
            }

            function updateCheckout() {
                const container = document.getElementById('checkout-items');
                const totalEl = document.getElementById('checkout-total');
                container.innerHTML = '';
                let total = 0;
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (!product) return;
                    const div = document.createElement('div');
                    const itemTotal = product.price * item.qty;
                    div.textContent = `${product.name} ($${product.price}) x ${item.qty} = $${itemTotal}`;
                    container.appendChild(div);
                    total += itemTotal;
                });
                totalEl.textContent = total.toFixed(2);
            }

            function buyCart() {
                const total = cart.reduce((a, item) => {
                    const product = products.find(p => p.id === item.id);
                    return a + (product ? product.price * item.qty : 0);
                }, 0);
                alert(`Checkout completed! Total amount: $${total.toFixed(2)}`);
                clearCart();
                closeFrame('checkout-frame');
            }

            // User Management
            let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
            const users = JSON.parse(localStorage.getItem('users')) || {};
            let seePassword = false;

            function toggleSee() {
                seePassword = !seePassword;
                const passInput = document.getElementById('signin-password');
                const pass2Input = document.getElementById('signin-password2');
                passInput.type = seePassword ? 'text' : 'password';
                pass2Input.type = seePassword ? 'text' : 'password';
            }

            let loginAttempts = 0;
            const loginLockTime = 60 * 60 * 1000;

            function submitLogin() {
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                const rank = document.getElementById('login-rank').value;
                let lockedUntil = localStorage.getItem('loginLockedUntil');
                if (lockedUntil && Date.now() < lockedUntil) {
                    alert('Login locked! Try later.');
                    return;
                }
                if (users[username] && users[username].password === password && users[username].rank === rank) {
                    currentUser = {
                        username,
                        rank
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    alert('Login successful!');
                    closeFrame('login-frame');
                } else {
                    loginAttempts++;
                    if (loginAttempts >= 5) {
                        localStorage.setItem('loginLockedUntil', Date.now() + loginLockTime);
                        alert('Too many wrong attempts! Locked for 1h.');
                    } else {
                        alert('Wrong credentials!');
                    }
                }
            }

            function submitSignin() {
                const username = document.getElementById('signin-username').value;
                const password = document.getElementById('signin-password').value;
                const password2 = document.getElementById('signin-password2').value;
                if (users[username]) {
                    alert('Username already taken!');
                    return;
                }
                if (password !== password2) {
                    alert('Passwords do not match!');
                    return;
                }
                users[username] = {
                    password,
                    rank: 'user'
                };
                localStorage.setItem('users', JSON.stringify(users));
                currentUser = {
                    username,
                    rank: 'user'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                alert('Account created successfully!');
                closeFrame('signin-frame');
            }

            // Recommendations
            const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];

            function renderRecommendations() {
                const container = document.getElementById('recommend-list');
                container.innerHTML = '';
                recommendations.forEach(rec => {
                    const div = document.createElement('div');
                    div.textContent = `(${rec.username} @ ${rec.time}): ${rec.text}`;
                    container.appendChild(div);
                });
            }

            function submitRecommendation() {
                if (!currentUser) {
                    alert('You need to login to access recommendations');
                    return;
                }
                const text = document.getElementById('recommend-input').value.trim();
                if (!text) return;
                const now = new Date();
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                recommendations.push({
                    username: currentUser.username,
                    text,
                    time: timeStr
                });
                localStorage.setItem('recommendations', JSON.stringify(recommendations));
                document.getElementById('recommend-input').value = '';
                renderRecommendations();
            }

            // Admin Logic
            let adminAttempts = 0;
            const adminLockTime = 24 * 60 * 60 * 1000;

            function submitAdminLogin() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                let lockedUntil = localStorage.getItem('adminLockedUntil');
                if (lockedUntil && Date.now() < lockedUntil) {
                    alert('Admin locked! Try later.');
                    return;
                }
                if (username === 'user' && password === 'password') {
                    alert('Admin access granted!');
                    adminAttempts = 0;
                    closeFrame('admin-frame');
                    openFrame('admin-panel-frame');
                } else {
                    adminAttempts++;
                    if (adminAttempts >= 3) {
                        localStorage.setItem('adminLockedUntil', Date.now() + adminLockTime);
                        alert('Too many wrong attempts! Locked for 24h.');
                    } else {
                        alert('Wrong credentials!');
                    }
                }
            }

            // Products
            let products = JSON.parse(localStorage.getItem('products')) || [];

            function saveProducts() {
                localStorage.setItem('products', JSON.stringify(products));
            }

            function addProduct() {
                const name = document.getElementById('add-name').value;
                const price = parseFloat(document.getElementById('add-price').value);
                const timer = document.getElementById('add-timer').value || null;
                const why = document.getElementById('add-why').value || '';
                const rank = document.getElementById('add-rank').value || '';
                if (!name || isNaN(price)) {
                    alert('Name and Price are required');
                    return;
                }
                const id = Date.now().toString();
                products.push({
                    id,
                    name,
                    price,
                    timer,
                    why,
                    rank
                });
                saveProducts();
                alert('Product added successfully!');
            }

            function editProduct() {
                const id = document.getElementById('edit-id').value;
                const product = products.find(p => p.id === id);
                if (!product) {
                    alert('Product not found');
                    return;
                }
                const name = document.getElementById('edit-name').value;
                const price = document.getElementById('edit-price').value;
                const timer = document.getElementById('edit-timer').value;
                const why = document.getElementById('edit-why').value;
                if (name) product.name = name;
                if (price) product.price = price;
                if (timer) product.timer = timer;
                if (why) product.why = why;
                saveProducts();
                alert('Product edited successfully!');
            }

            function deleteProduct() {
                const id = document.getElementById('delete-id').value;
                const index = products.findIndex(p => p.id === id);
                if (index === -1) {
                    alert('Product not found');
                    return;
                }
                products.splice(index, 1);
                saveProducts();
                alert('Product deleted successfully!');
            }

            function shutdownWebsite() {
                if (confirm('Are you sure you want to shut down the website?')) {
                    document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">Website Shutdown</h1>';
                }
            }

            function displayTimers() {
                const now = new Date().getTime();
                products.forEach(p => {
                    if (p.timer) {
                        const diff = new Date(p.timer).getTime() - now;
                        p.remaining = diff > 0 ? diff : 0;
                    }
                });
            }
            setInterval(displayTimers, 1000);

            // Settings and Cookies
            const bgColorInput = document.getElementById('bg-color');
            const savedColor = localStorage.getItem('bgColor') || '#ffffff';
            document.body.style.backgroundColor = savedColor;
            bgColorInput.value = savedColor;

            function changeBackgroundColor() {
                const color = bgColorInput.value;
                document.body.style.backgroundColor = color;
                localStorage.setItem('bgColor', color);
            }

            const music = document.getElementById('bg-music');
            const savedVolume = localStorage.getItem('musicVolume') || 0.5;
            music.volume = savedVolume;
            music.play().catch(e => console.log('Autoplay blocked:', e));

            const volumeInput = document.getElementById('music-volume');
            volumeInput.value = savedVolume;

            function changeVolume() {
                const vol = volumeInput.value;
                music.volume = vol;
                localStorage.setItem('musicVolume', vol);
            }

            function logout() {
                currentUser = null;
                localStorage.removeItem('currentUser');
                alert('You have been logged out.');
                closeFrame('settings-frame');
            }

            function acceptCookies() {
                localStorage.setItem('cookiesAccepted', 'true');
                alert('Cookies accepted!');
                closeFrame('cookies-frame');
            }

            function declineCookies() {
                localStorage.setItem('cookiesAccepted', 'false');
                alert('Cookies declined!');
                closeFrame('cookies-frame');
            }

            // Top button event listeners
            document.getElementById('cart-btn').addEventListener('click', () => openFrame('cart-frame'));
            document.getElementById('admin-btn').addEventListener('click', () => openFrame('admin-frame'));
            document.getElementById('login-btn').addEventListener('click', () => openFrame('login-frame'));
            document.getElementById('signin-btn').addEventListener('click', () => openFrame('signin-frame'));
            document.getElementById('recommend-btn').addEventListener('click', () => {
                if (!currentUser) {
                    alert('You need to login to access recommendations');
                } else {
                    openFrame('recommend-frame');
                    renderRecommendations();
                }
            });
            document.getElementById('settings-btn').addEventListener('click', () => {
                if (currentUser) {
                    openFrame('settings-frame');
                } else {
                    alert('You need to login to access settings');
                }
            });
            document.getElementById('cookies-btn').addEventListener('click', () => {
                openFrame('cookies-frame');
            });

            // Make sure these functions are available in the global scope
            window.openFrame = openFrame;
            window.closeFrame = closeFrame;
            window.updateQty = updateQty;
            window.removeFromCart = removeFromCart;
            window.clearCart = clearCart;
            window.openCheckout = openCheckout;
            window.buyCart = buyCart;
            window.submitAdminLogin = submitAdminLogin;
            window.addProduct = addProduct;
            window.editProduct = editProduct;
            window.deleteProduct = deleteProduct;
            window.shutdownWebsite = shutdownWebsite;
            window.changeBackgroundColor = changeBackgroundColor;
            window.changeVolume = changeVolume;
            window.logout = logout;
            window.acceptCookies = acceptCookies;
            window.declineCookies = declineCookies;
            window.submitLogin = submitLogin;
            window.submitSignin = submitSignin;
            window.toggleSee = toggleSee;
            window.submitRecommendation = submitRecommendation;
            window.addToCart = addToCart; // Exposed for testing

            updateCartUI();
        }
    </script>
</body>
</html>
